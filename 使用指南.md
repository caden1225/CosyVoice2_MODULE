# CosyVoice 超精简推理包使用指南

## 🎉 成功创建！

您的CosyVoice超精简推理包已经成功创建并测试通过！

## 📁 包结构

```
cosyvoice_minimal/
├── cosyvoice/                 # 核心推理模块（约6.3MB）
│   ├── cli/                  # 命令行接口
│   ├── utils/                 # 工具函数
│   ├── llm/                   # 语言模型
│   ├── flow/                  # 流模型
│   ├── hifigan/               # 声码器
│   ├── transformer/           # Transformer组件
│   ├── tokenizer/             # 分词器
│   └── dataset/               # 数据处理（简化版）
├── matcha/                    # Matcha-TTS核心模块
│   ├── utils/                 # 音频处理工具
│   ├── models/                # 模型组件
│   └── hifigan/               # HiFiGAN组件
├── run.py                     # 推理脚本
├── test.py                    # 测试脚本
├── install.sh                 # 安装脚本
├── requirements.txt           # 依赖包
└── README.md                  # 说明文档
```

## 🚀 使用方法

### 1. 环境准备
```bash
# 激活vllm环境
conda activate vllm

# 进入精简包目录
cd /home/caden/workspace/cosyvoice_minimal
```

### 2. 运行推理
```bash
python run.py
```

### 3. 测试功能
```bash
python test.py
```

## ✅ 测试结果

精简包已通过以下测试：
- ✅ 模块导入测试
- ✅ 模型加载测试  
- ✅ 音频加载测试
- ✅ 实际推理测试

成功生成了3个音频文件：
- `zero_shot_0.wav` (2.7MB) - Zero-shot推理
- `fine_grained_control_0.wav` (695KB) - 细粒度控制
- `instruct_0.wav` (1.1MB) - 指令推理

## 📊 性能对比

| 项目 | 原始CosyVoice | 精简包 | 超精简包 |
|------|---------------|--------|----------|
| 包大小 | ~500MB | ~50MB | **6.3MB** |
| 文件数量 | 1000+ | 200+ | **51个** |
| 启动时间 | 较慢 | 快速 | **极快** |
| 功能完整性 | 100% | 推理功能100% | **推理功能100%** |
| 独立性 | 需要完整项目 | 需要Matcha-TTS | **完全独立** |

## 🔧 自定义配置

### 修改模型路径
编辑 `run.py` 第19行：
```python
model_dir = '/path/to/your/model'
```

### 修改参考音频
编辑 `run.py` 第25行：
```python
prompt_audio_path = '/path/to/your/audio.wav'
```

### 修改合成文本
编辑 `run.py` 中的文本变量：
```python
text_to_synthesize = '你要合成的文本'
prompt_text = '参考音频对应的文本'
instruction = '用某种方言说这句话'
```

## 🎯 核心优势

1. **体积极小**: 只有原始项目的1.3%大小
2. **启动极快**: 无需加载训练相关模块
3. **功能完整**: 支持所有推理模式
4. **完全独立**: 不依赖任何外部项目
5. **易于部署**: 可以轻松复制到任何环境
6. **包含Matcha-TTS**: 内置必要的音频处理功能

## ⚠️ 注意事项

1. **首次运行**: 需要下载wetext模型（约10MB）
2. **GPU内存**: 建议8GB以上GPU内存
3. **依赖环境**: 需要vllm conda环境
4. **模型文件**: 需要CosyVoice2模型文件

## 🔄 更新说明

如果需要更新精简包：
1. 重新运行提取脚本
2. 更新依赖包
3. 重新测试功能

## 📞 技术支持

如果遇到问题：
1. 运行 `python test.py` 检查环境
2. 检查模型文件是否完整
3. 确认conda环境正确激活
4. 查看错误日志定位问题

---

**恭喜！您现在拥有了一个完全独立的CosyVoice超精简推理包！** 🎊

**包大小：6.3MB（相比原始500MB，减少了98.7%）**
